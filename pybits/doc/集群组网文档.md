# åŒ—äº¬-ä¸Šæµ·åˆ†å¸ƒå¼WSLé›†ç¾¤è¿œç¨‹å¼€å‘ç¯å¢ƒå®Œæ•´æ–¹æ¡ˆ

## ğŸ“‹ ç¬¬ä¸€ç« ï¼šé¡¹ç›®æ€»è§ˆ

### 1.1 æ ¸å¿ƒç›®æ ‡
åˆ©ç”¨ä¸¤åœ°é—²ç½®ç¬”è®°æœ¬ç”µè„‘ç»„æˆè·¨åœ°åŸŸDocker Swarmé›†ç¾¤ï¼Œå®ç°ç»Ÿä¸€å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²ç¯å¢ƒï¼Œæ”¯æŒå¼‚åœ°ååŒå¼€å‘ã€‚

### 1.2 ç¡¬ä»¶æ¶æ„
```
åŒ—äº¬ï¼ˆæ•°æ®ä¸­å¿ƒ1ï¼‰
â”œâ”€ ç¬”è®°æœ¬ï¼ˆWSL 2ï¼‰ï¼šé›†ç¾¤ç®¡ç†èŠ‚ç‚¹ + 1Panelä¸»æ§åˆ¶å°
â””â”€ å°å¼æœºï¼šå¼€å‘å·¥ä½œç«™

ä¸Šæµ·ï¼ˆæ•°æ®ä¸­å¿ƒ2ï¼‰  
â”œâ”€ ç¬”è®°æœ¬ï¼ˆWSL 2ï¼‰ï¼šé›†ç¾¤å·¥ä½œèŠ‚ç‚¹ + 1Panelå‰¯æ§åˆ¶å°
â””â”€ å°å¼æœºï¼šå¼€å‘å·¥ä½œç«™
```

### 1.3 æŠ€æœ¯æ ˆ
- **ç½‘ç»œå±‚**ï¼šTailscaleï¼ˆè™šæ‹Ÿä¸“ç”¨ç½‘ï¼‰
- **å®¹å™¨ç¼–æ’**ï¼šDocker Swarm
- **å¯è§†åŒ–è¿ç»´**ï¼š1Panel
- **å¼€å‘ç¯å¢ƒ**ï¼šVS Code + Remote-SSH
- **æ“ä½œç³»ç»Ÿ**ï¼šWSL 2 + Ubuntu 22.04 LTS

---

## ğŸ”§ ç¬¬äºŒç« ï¼šåŸºç¡€ç¯å¢ƒæ­å»º

### 2.1 WSL 2 å®‰è£…ä¸ä¼˜åŒ–

#### æ­¥éª¤1ï¼šå®‰è£…WSL 2ï¼ˆWindows PowerShellç®¡ç†å‘˜ï¼‰
```powershell
# å¯ç”¨WSLåŠŸèƒ½
wsl --install

# å¦‚æœä¸‹è½½æ…¢ï¼Œä½¿ç”¨å›½å†…é•œåƒ
wsl --install -d Ubuntu-22.04 --web-download-source https://mirror.azure.cn/wsl/

# è®¾ç½®WSL 2ä¸ºé»˜è®¤ç‰ˆæœ¬
wsl --set-default-version 2
```

#### æ­¥éª¤2ï¼šWSL 2æ€§èƒ½ä¼˜åŒ–é…ç½®
```bash
# åœ¨Windowsåˆ›å»ºé…ç½®æ–‡ä»¶ï¼š%UserProfile%\.wslconfig
[wsl2]
memory=4GB        # åˆ†é…4GBå†…å­˜
processors=2      # åˆ†é…2ä¸ªCPUæ ¸å¿ƒ
swap=1GB          # 1GBäº¤æ¢ç©ºé—´
localhostForwarding=true

# é‡å¯WSLç”Ÿæ•ˆ
wsl --shutdown
```

#### æ­¥éª¤3ï¼šUbuntuåŸºç¡€é…ç½®
```bash
# æ›´æ–°ç³»ç»Ÿå¹¶å®‰è£…å¿…è¦ç»„ä»¶
sudo apt update && sudo apt upgrade -y
sudo apt install -y curl wget git vim net-tools htop

# è®¾ç½®æ—¶åŒºï¼ˆä¸¤åœ°ç»Ÿä¸€ä¸ºä¸Šæµ·æ—¶é—´ï¼‰
sudo timedatectl set-timezone Asia/Shanghai

# é…ç½®SSHæœåŠ¡å™¨
sudo apt install -y openssh-server
sudo sed -i 's/#PasswordAuthentication yes/PasswordAuthentication yes/g' /etc/ssh/sshd_config
sudo sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin no/g' /etc/ssh/sshd_config
sudo systemctl enable ssh
sudo systemctl start ssh
```

### 2.2 Tailscaleç½‘ç»œé…ç½®

#### æ­¥éª¤1ï¼šæ‰€æœ‰è®¾å¤‡å®‰è£…Tailscale
```bash
# åœ¨WSLä¸­å®‰è£…
curl -fsSL https://tailscale.com/install.sh | sh
sudo tailscale up

# åœ¨Windowså°å¼æœºå®‰è£…
# ä¸‹è½½ï¼šhttps://tailscale.com/download/windows
# å®‰è£…åä½¿ç”¨åŒä¸€è´¦å·ç™»å½•
```

#### æ­¥éª¤2ï¼šç½‘ç»œé…ç½®ä¼˜åŒ–
```bash
# åœ¨Windowsç¬”è®°æœ¬ä¸»æœºå¯ç”¨å­ç½‘è·¯ç”±ï¼ˆPowerShellç®¡ç†å‘˜ï¼‰
tailscale up --advertise-routes=172.16.0.0/12 --accept-routes=true

# åœ¨Tailscaleç®¡ç†åå°æ‰¹å‡†è·¯ç”±
# è®¿é—®ï¼šhttps://login.tailscale.com/admin/machines
# æ‰¾åˆ°è®¾å¤‡ â†’ ä¸‰ç‚¹èœå• â†’ Edit route settings â†’ å¯ç”¨è·¯ç”±
```

#### æ­¥éª¤3ï¼šç½‘ç»œè¿é€šæ€§æµ‹è¯•
```bash
# è·å–æ‰€æœ‰è®¾å¤‡IP
tailscale status

# æµ‹è¯•åŒ—äº¬-ä¸Šæµ·è¿é€šæ€§
ping <ä¸Šæµ·ç¬”è®°æœ¬Tailscale IP>
ping <ä¸Šæµ·å°å¼æœºTailscale IP>

# æµ‹è¯•å­ç½‘è·¯ç”±
ping <å¯¹æ–¹WSLå†…éƒ¨IP>  # å¦‚172.xx.xx.xx
```

---

## ğŸ–¥ï¸ ç¬¬ä¸‰ç« ï¼š1Panelå®‰è£…ä¸é…ç½®

### 3.1 1Panelä¸»èŠ‚ç‚¹å®‰è£…ï¼ˆåŒ—äº¬ï¼‰

#### æ­¥éª¤1ï¼šè¿è¡Œä¼˜åŒ–å®‰è£…è„šæœ¬
```bash
# ä¸‹è½½å¹¶æ‰§è¡Œå®‰è£…è„šæœ¬
curl -sSL https://cdn.fit2cloud.com/1panel/package/quick_start.sh -o quick_start.sh

# ä¿®æ”¹ä¸ºå›½å†…æºï¼ˆå¯é€‰ï¼‰
sed -i 's|https://download.docker.com|https://mirrors.aliyun.com/docker-ce|g' quick_start.sh

# æ‰§è¡Œå®‰è£…
sudo bash quick_start.sh
```

#### æ­¥éª¤2ï¼šè®°å½•å®‰è£…ä¿¡æ¯
```bash
# æŸ¥çœ‹åˆå§‹å‡­æ®
sudo cat /opt/1panel/credentials/initial_admin_password.txt

# æŸ¥çœ‹è®¿é—®åœ°å€
hostname -I
# ä¼šæ˜¾ç¤ºç±»ä¼¼ï¼š172.28.xx.xx
```

#### æ­¥éª¤3ï¼šé˜²ç«å¢™é…ç½®
```bash
# å¼€æ”¾å¿…è¦ç«¯å£
sudo ufw --force enable
sudo ufw allow 22/tcp                    # SSH
sudo ufw allow 9001/tcp                  # 1Panelé»˜è®¤ç«¯å£
sudo ufw allow 2377/tcp                  # Swarmç®¡ç†ç«¯å£
sudo ufw allow 7946/tcp,udp              # èŠ‚ç‚¹é€šä¿¡
sudo ufw allow 4789/udp                  # Overlayç½‘ç»œ
sudo ufw allow 80,443/tcp                # WebæœåŠ¡
sudo ufw reload
```

### 3.2 1Panelä»èŠ‚ç‚¹å®‰è£…ï¼ˆä¸Šæµ·ï¼‰

#### æ­¥éª¤1ï¼šå®‰è£…1Panelï¼ˆä¸åŒ—äº¬ç›¸åŒï¼‰
```bash
# ä½¿ç”¨ç›¸åŒè„šæœ¬å®‰è£…
curl -sSL https://cdn.fit2cloud.com/1panel/package/quick_start.sh | sudo bash
```

#### æ­¥éª¤2ï¼šé…ç½®å·®å¼‚åŒ–
```bash
# ä¿®æ”¹1Panelé»˜è®¤ç«¯å£é¿å…å†²çª
sudo sed -i 's/port: 9001/port: 9002/g' /opt/1panel/conf/app.yaml
sudo 1panel restart

# ä¸Šæµ·èŠ‚ç‚¹ä½¿ç”¨9002ç«¯å£è®¿é—®
# URL: https://<ä¸Šæµ·Tailscale IP>:9002
```

### 3.3 1Panelå®‰å…¨åŠ å›º

#### é…ç½®1ï¼šä¿®æ”¹è®¿é—®ç«¯å£
```yaml
# /opt/1panel/conf/app.yaml ä¿®æ”¹ä»¥ä¸‹é…ç½®
server:
  port: 28901  # åŒ—äº¬èŠ‚ç‚¹
  # port: 28902  # ä¸Šæµ·èŠ‚ç‚¹
  ssl:
    enable: true
    ssl_port: 28943
```

#### é…ç½®2ï¼šIPç™½åå•è®¾ç½®
```
# åœ¨1Panelé¢æ¿ï¼šè®¾ç½® â†’ å®‰å…¨ â†’ è®¿é—®é™åˆ¶
å…è®¸IPåˆ—è¡¨ï¼š
- åŒ—äº¬å°å¼æœºTailscale IP
- ä¸Šæµ·å°å¼æœºTailscale IP
- 127.0.0.1
```

#### é…ç½®3ï¼šå¯ç”¨HTTPS
```bash
# ä½¿ç”¨Tailscale MagicDNSç”³è¯·è¯ä¹¦
# 1. åœ¨Tailscaleç®¡ç†åå°å¯ç”¨MagicDNS
# 2. åœ¨1Panelä¸­ç”³è¯·è¯ä¹¦
#    è¯ä¹¦ç®¡ç† â†’ ç”³è¯·è¯ä¹¦ â†’ DNSéªŒè¯
#    åŸŸåï¼šbeijing-cluster.yournetwork.ts.net
```

---

## ğŸ³ ç¬¬å››ç« ï¼šDocker Swarmé›†ç¾¤æ­å»º

### 4.1 åˆå§‹åŒ–Swarmé›†ç¾¤

#### æ­¥éª¤1ï¼šåŒ—äº¬èŠ‚ç‚¹åˆå§‹åŒ–ï¼ˆç®¡ç†èŠ‚ç‚¹ï¼‰
```bash
# ä½¿ç”¨Tailscale IPä½œä¸ºå¹¿æ’­åœ°å€
docker swarm init --advertise-addr <åŒ—äº¬Tailscale IP>

# è¾“å‡ºç¤ºä¾‹ï¼š
# docker swarm join --token SWMTKN-1-xxx <åŒ—äº¬Tailscale IP>:2377

# è·å–åŠ å…¥ä»¤ç‰Œï¼ˆå¤‡ä»½é‡è¦ï¼‰
docker swarm join-token worker
docker swarm join-token manager
```

#### æ­¥éª¤2ï¼šä¸Šæµ·èŠ‚ç‚¹åŠ å…¥é›†ç¾¤
```bash
# åœ¨ä¸Šæµ·èŠ‚ç‚¹æ‰§è¡ŒåŒ—äº¬èŠ‚ç‚¹è¾“å‡ºçš„å‘½ä»¤
docker swarm join --token <token> <åŒ—äº¬Tailscale IP>:2377

# éªŒè¯åŠ å…¥æˆåŠŸ
docker node ls  # åº”åœ¨åŒ—äº¬èŠ‚ç‚¹æ‰§è¡Œ
```

### 4.2 é›†ç¾¤ç½‘ç»œé…ç½®

#### åˆ›å»ºOverlayç½‘ç»œ
```bash
# åœ¨åŒ—äº¬èŠ‚ç‚¹åˆ›å»º
docker network create \
  --driver overlay \
  --subnet=10.11.0.0/16 \
  --attachable \
  swarm_net

# éªŒè¯ç½‘ç»œ
docker network ls | grep swarm
```

#### é…ç½®èŠ‚ç‚¹æ ‡ç­¾ï¼ˆåœ°ç†æ„ŸçŸ¥ï¼‰
```bash
# æ ‡è®°åŒ—äº¬èŠ‚ç‚¹
docker node update --label-add zone=beijing --label-add role=manager <åŒ—äº¬èŠ‚ç‚¹ID>

# æ ‡è®°ä¸Šæµ·èŠ‚ç‚¹  
docker node update --label-add zone=shanghai --label-add role=worker <ä¸Šæµ·èŠ‚ç‚¹ID>

# æŸ¥çœ‹èŠ‚ç‚¹æ ‡ç­¾
docker node inspect <èŠ‚ç‚¹ID> | grep -A5 Labels
```

### 4.3 é›†ç¾¤å­˜å‚¨é…ç½®

#### é…ç½®1ï¼šæœ¬åœ°å­˜å‚¨å·
```bash
# åœ¨ä¸¤èŠ‚ç‚¹åˆ›å»ºç›¸åŒç›®å½•ç»“æ„
sudo mkdir -p /data/docker/{volumes,backups,configs}
sudo chmod -R 777 /data/docker
```

#### é…ç½®2ï¼šNFSå…±äº«å­˜å‚¨ï¼ˆå¯é€‰ï¼‰
```bash
# åŒ—äº¬èŠ‚ç‚¹ä½œä¸ºNFSæœåŠ¡å™¨
sudo apt install -y nfs-kernel-server
echo "/data/docker/volumes *(rw,sync,no_subtree_check,no_root_squash)" | sudo tee -a /etc/exports
sudo exportfs -a
sudo systemctl restart nfs-kernel-server

# ä¸Šæµ·èŠ‚ç‚¹æŒ‚è½½NFS
sudo apt install -y nfs-common
sudo mkdir -p /data/docker/volumes
echo "<åŒ—äº¬Tailscale IP>:/data/docker/volumes /data/docker/volumes nfs defaults 0 0" | sudo tee -a /etc/fstab
sudo mount -a
```

---

## ğŸ’» ç¬¬äº”ç« ï¼šå¼€å‘ç¯å¢ƒé…ç½®

### 5.1 SSHå¯†é’¥é…ç½®

#### ç”ŸæˆSSHå¯†é’¥å¯¹
```bash
# åœ¨å°å¼æœºç”Ÿæˆå¯†é’¥
ssh-keygen -t ed25519 -C "dev@beijing" -f ~/.ssh/id_ed25519_beijing
ssh-keygen -t ed25519 -C "dev@shanghai" -f ~/.ssh/id_ed25519_shanghai

# æŸ¥çœ‹å…¬é’¥
cat ~/.ssh/id_ed25519_beijing.pub
```

#### é…ç½®WSL SSHå…¬é’¥
```bash
# åœ¨WSLä¸­å®‰è£…å…¬é’¥
mkdir -p ~/.ssh
echo "<å…¬é’¥å†…å®¹>" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh
```

### 5.2 VS Codeè¿œç¨‹å¼€å‘é…ç½®

#### é…ç½®SSHè¿æ¥
```config
# ~/.ssh/config æ–‡ä»¶é…ç½®
# åŒ—äº¬è¿æ¥é…ç½®
Host beijing-wsl
    HostName <åŒ—äº¬ç¬”è®°æœ¬Tailscale IP>
    User <ç”¨æˆ·å>
    IdentityFile ~/.ssh/id_ed25519_beijing
    Port 22
    ServerAliveInterval 60
    TCPKeepAlive yes

# ä¸Šæµ·è¿æ¥é…ç½®  
Host shanghai-wsl
    HostName <ä¸Šæµ·ç¬”è®°æœ¬Tailscale IP>
    User <ç”¨æˆ·å>
    IdentityFile ~/.ssh/id_ed25519_shanghai
    Port 22
    ServerAliveInterval 60
    TCPKeepAlive yes

# é€šè¿‡å­ç½‘è·¯ç”±ç›´è¿ï¼ˆæ›´ç¨³å®šï¼‰
Host beijing-wsl-direct
    HostName <åŒ—äº¬WSLå†…éƒ¨IP>  # å¦‚172.28.xx.xx
    User <ç”¨æˆ·å>
    IdentityFile ~/.ssh/id_ed25519_beijing
    ProxyCommand ssh -W %h:%p <åŒ—äº¬ç¬”è®°æœ¬Tailscale IP>
```

#### å®‰è£…VS Codeæ‰©å±•
```
å¿…è£…æ‰©å±•ï¼š
- Remote - SSH
- Remote - Containers  
- Docker
- GitLens
- WSL (Windowsç«¯)
```

### 5.3 å¼€å‘ç¯å¢ƒå®¹å™¨åŒ–

#### åˆ›å»ºå¼€å‘ç¯å¢ƒStack
```yaml
# docker-compose.dev.yml
version: '3.8'

services:
  node-dev:
    image: node:18-alpine
    volumes:
      - ./code:/app
    working_dir: /app
    networks:
      - swarm_net
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.labels.zone == beijing
    command: tail -f /dev/null  # ä¿æŒå®¹å™¨è¿è¡Œ

  python-dev:
    image: python:3.11-slim
    volumes:
      - ./code:/app
    working_dir: /app
    networks:
      - swarm_net
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.labels.zone == shanghai
    command: tail -f /dev/null
```

---

## ğŸš€ ç¬¬å…­ç« ï¼šåº”ç”¨éƒ¨ç½²ä¸ç®¡ç†

### 6.1 é€šè¿‡1Paneléƒ¨ç½²åº”ç”¨

#### éƒ¨ç½²WordPressé›†ç¾¤ç¤ºä¾‹
```yaml
# åœ¨1Panelä¸­åˆ›å»ºStack
version: '3.8'

services:
  wordpress:
    image: wordpress:php8.2-apache
    ports:
      - "8080:80"
    environment:
      WORDPRESS_DB_HOST: mysql
      WORDPRESS_DB_USER: wpuser
      WORDPRESS_DB_PASSWORD: wppass
      WORDPRESS_DB_NAME: wordpress
    volumes:
      - wordpress_data:/var/www/html
    networks:
      - swarm_net
    deploy:
      replicas: 2
      placement:
        spread: node.labels.zone

  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: rootpass
      MYSQL_DATABASE: wordpress
      MYSQL_USER: wpuser
      MYSQL_PASSWORD: wppass
    volumes:
      - mysql_data:/var/lib/mysql
    networks:
      - swarm_net
    deploy:
      replicas: 1
      placement:
        constraints:
          - node.labels.zone == beijing  # æ•°æ®åº“æ”¾åŒ—äº¬

volumes:
  wordpress_data:
    driver: local
  mysql_data:
    driver: local

networks:
  swarm_net:
    external: true
```

### 6.2 ç›‘æ§ç³»ç»Ÿéƒ¨ç½²

#### éƒ¨ç½²Prometheus + Grafana
```bash
# åˆ›å»ºç›‘æ§ç›®å½•
mkdir -p ~/monitoring/{prometheus,grafana}

# prometheus.yml é…ç½®
cat > ~/monitoring/prometheus/prometheus.yml << EOF
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'docker-swarm'
    static_configs:
      - targets: ['åŒ—äº¬èŠ‚ç‚¹Tailscale IP:9323', 'ä¸Šæµ·èŠ‚ç‚¹Tailscale IP:9323']
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['åŒ—äº¬èŠ‚ç‚¹Tailscale IP:9100', 'ä¸Šæµ·èŠ‚ç‚¹Tailscale IP:9100']
EOF

# éƒ¨ç½²ç›‘æ§Stack
docker stack deploy -c ~/monitoring/docker-compose.monitoring.yml monitoring
```

### 6.3 CI/CDæµæ°´çº¿é…ç½®

#### GitHub Actionså·¥ä½œæµ
```yaml
# .github/workflows/deploy.yml
name: Deploy to Swarm Cluster

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Build and Push Docker Image
        run: |
          docker build -t your-app:${{ github.sha }} .
          docker tag your-app:${{ github.sha }} your-app:latest
          
      - name: Deploy to Beijing
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.BEIJING_HOST }}
          username: ${{ secrets.SSH_USER }}
          key: ${{ secrets.SSH_KEY }}
          script: |
            docker service update --image your-app:${{ github.sha }} your_app_service
            
      - name: Deploy to Shanghai
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SHANGHAI_HOST }}
          username: ${{ secrets.SSH_USER }}
          key: ${{ secrets.SSH_KEY }}
          script: |
            docker service update --image your-app:${{ github.sha }} your_app_service
```

---

## ğŸ›¡ï¸ ç¬¬ä¸ƒç« ï¼šå®‰å…¨ä¸ç»´æŠ¤

### 7.1 å®‰å…¨é…ç½®æ¸…å•

#### Dockerå®‰å…¨åŠ å›º
```bash
# 1. å¯ç”¨ç”¨æˆ·å‘½åç©ºé—´
sudo vim /etc/docker/daemon.json
{
  "userns-remap": "default",
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  }
}

# 2. é™åˆ¶å®¹å™¨èµ„æº
docker run --memory=512m --cpus="1.0" your-image

# 3. å®šæœŸæ‰«ææ¼æ´
docker scan your-image
```

#### 1Panelå®‰å…¨è®¾ç½®
```bash
# 1. å®šæœŸä¿®æ”¹å¯†ç 
# 2. å¯ç”¨ç™»å½•å¤±è´¥é”å®š
# 3. é…ç½®æ“ä½œæ—¥å¿—å®¡è®¡
# 4. å®šæœŸå¤‡ä»½é¢æ¿æ•°æ®
```

### 7.2 å¤‡ä»½ç­–ç•¥

#### æ¯æ—¥è‡ªåŠ¨å¤‡ä»½è„šæœ¬
```bash
#!/bin/bash
# /opt/scripts/backup.sh

BACKUP_DIR="/data/backups/$(date +%Y%m%d)"
mkdir -p $BACKUP_DIR

# å¤‡ä»½1Panelæ•°æ®
sudo tar -czf $BACKUP_DIR/1panel_data.tar.gz /opt/1panel

# å¤‡ä»½Dockeré…ç½®
docker stack ls | awk 'NR>1 {print $1}' | xargs -I {} sh -c 'docker stack config {} > $BACKUP_DIR/stack_{}.yml'

# å¤‡ä»½Swarmé…ç½®
docker node ls --format "{{.ID}} {{.Hostname}}" > $BACKUP_DIR/swarm_nodes.txt
docker swarm ca --rotate --quiet > $BACKUP_DIR/swarm_ca.crt

# åŒæ­¥åˆ°å¯¹æ–¹èŠ‚ç‚¹ï¼ˆå¼‚åœ°å¤‡ä»½ï¼‰
rsync -avz $BACKUP_DIR/ <å¯¹æ–¹èŠ‚ç‚¹Tailscale IP>:/data/backups/remote/
```

#### è®¾ç½®å®šæ—¶ä»»åŠ¡
```bash
# æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œå¤‡ä»½
echo "0 2 * * * /opt/scripts/backup.sh" | sudo crontab -
```

### 7.3 æ•…éšœæ¢å¤æŒ‡å—

#### èŠ‚ç‚¹æ•…éšœæ¢å¤
```bash
# 1. èŠ‚ç‚¹å¤±è”å¤„ç†
docker node update --availability drain <æ•…éšœèŠ‚ç‚¹ID>

# 2. ä¿®å¤åé‡æ–°åŠ å…¥
# åœ¨æ•…éšœèŠ‚ç‚¹æ‰§è¡Œ
docker swarm leave --force
docker swarm join --token <token> <ç®¡ç†èŠ‚ç‚¹IP>:2377

# 3. æ¢å¤æœåŠ¡
docker node update --availability active <èŠ‚ç‚¹ID>
```

#### 1Panelæ•…éšœæ¢å¤
```bash
# 1. é‡è£…1Panelï¼ˆä¿ç•™æ•°æ®ï¼‰
sudo 1panel uninstall --keep-data
sudo bash quick_start.sh

# 2. ä»å¤‡ä»½æ¢å¤
# åœ¨1Panelé¢æ¿ï¼šè®¾ç½® â†’ å¤‡ä»½ä¸æ¢å¤
```

---

## ğŸ“Š ç¬¬å…«ç« ï¼šæ€§èƒ½ä¼˜åŒ–

### 8.1 WSL 2æ€§èƒ½è°ƒä¼˜
```bash
# 1. ç£ç›˜æ€§èƒ½ä¼˜åŒ–
# å°†é¡¹ç›®ä»£ç æ”¾åœ¨WSLæ–‡ä»¶ç³»ç»Ÿå†…ï¼Œè€ŒéWindowsæŒ‚è½½ç‚¹

# 2. å†…å­˜ä¼˜åŒ–
# è°ƒæ•´.wslconfigä¸­çš„memoryé™åˆ¶

# 3. CPUä¼˜åŒ–
wsl --set-version Ubuntu 2
```

### 8.2 Dockeræ€§èƒ½ä¼˜åŒ–
```bash
# 1. ä½¿ç”¨AlpineåŸºç¡€é•œåƒ
# 2. å¤šé˜¶æ®µæ„å»ºå‡å°‘é•œåƒå¤§å°
# 3. é…ç½®Dockeræ—¥å¿—è½®è½¬
```

### 8.3 ç½‘ç»œæ€§èƒ½ä¼˜åŒ–
```bash
# 1. å¯ç”¨Tailscaleç›´è¿
tailscale status --peers
# æŸ¥çœ‹æ˜¯å¦ä¸ºDirectè¿æ¥

# 2. ä½¿ç”¨æœ€è¿‘èŠ‚ç‚¹ç­–ç•¥
# åœ¨ç¼–æ’æ–‡ä»¶ä¸­æ·»åŠ çº¦æŸ
deploy:
  placement:
    preferences:
      - spread: node.labels.zone
```

---

## ğŸ§ª ç¬¬ä¹ç« ï¼šæµ‹è¯•ä¸éªŒè¯

### 9.1 è¿é€šæ€§æµ‹è¯•å¥—ä»¶
```bash
#!/bin/bash
# test_connectivity.sh

echo "=== ç½‘ç»œè¿é€šæ€§æµ‹è¯• ==="

# æµ‹è¯•æ‰€æœ‰èŠ‚ç‚¹äº’é€š
NODES=("åŒ—äº¬ç¬”è®°æœ¬" "åŒ—äº¬å°å¼æœº" "ä¸Šæµ·ç¬”è®°æœ¬" "ä¸Šæµ·å°å¼æœº")

for node in "${NODES[@]}"; do
  echo "æµ‹è¯•è¿æ¥åˆ° $node..."
  ping -c 3 $node
done

echo "=== æœåŠ¡å¯ç”¨æ€§æµ‹è¯• ==="

# æµ‹è¯•1Panelè®¿é—®
curl -k https://åŒ—äº¬Tailscale IP:28901
curl -k https://ä¸Šæµ·Tailscale IP:28902

# æµ‹è¯•Swarmé›†ç¾¤
docker node ls
docker service ls

echo "=== åº”ç”¨éƒ¨ç½²æµ‹è¯• ==="

# éƒ¨ç½²æµ‹è¯•åº”ç”¨
docker service create --name test --replicas 2 nginx:alpine
sleep 10
docker service ps test
```

### 9.2 æ€§èƒ½åŸºå‡†æµ‹è¯•
```bash
# ç½‘ç»œå»¶è¿Ÿæµ‹è¯•
ping -c 100 <å¯¹æ–¹èŠ‚ç‚¹IP> | tail -n 4

# å¸¦å®½æµ‹è¯•
# å®‰è£…iperf3
sudo apt install iperf3

# ä¸€ç«¯ä½œä¸ºæœåŠ¡å™¨
iperf3 -s

# å¦ä¸€ç«¯æµ‹è¯•
iperf3 -c <æœåŠ¡å™¨IP> -t 30
```

---

## ğŸ“ ç¬¬åç« ï¼šè¿ç»´æ‰‹å†Œ

### 10.1 æ—¥å¸¸æ£€æŸ¥æ¸…å•
```bash
# daily_check.sh
#!/bin/bash

echo "1. èŠ‚ç‚¹çŠ¶æ€æ£€æŸ¥"
docker node ls

echo "2. æœåŠ¡çŠ¶æ€æ£€æŸ¥"
docker service ls
docker service ps $(docker service ls -q)

echo "3. èµ„æºä½¿ç”¨æƒ…å†µ"
docker stats --no-stream

echo "4. 1Panelå¥åº·çŠ¶æ€"
sudo 1panel status

echo "5. Tailscaleè¿æ¥çŠ¶æ€"
tailscale status

echo "6. ç£ç›˜ç©ºé—´"
df -h

echo "7. å†…å­˜ä½¿ç”¨"
free -h
```

### 10.2 åº”æ€¥å“åº”æµç¨‹

#### åœºæ™¯1ï¼šèŠ‚ç‚¹å¤±è”
```
1. æ£€æŸ¥Tailscaleè¿æ¥
2. æ£€æŸ¥èŠ‚ç‚¹èµ„æºçŠ¶æ€
3. å¦‚æœæ— æ³•æ¢å¤ï¼Œæ ‡è®°ä¸ºdrain
4. æ•…éšœæ’æŸ¥åé‡æ–°åŠ å…¥
5. æ¢å¤ä¸ºactiveçŠ¶æ€
```

#### åœºæ™¯2ï¼šæœåŠ¡å¼‚å¸¸
```
1. æŸ¥çœ‹æœåŠ¡æ—¥å¿—ï¼šdocker service logs <æœåŠ¡å>
2. æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼šdocker service ps <æœåŠ¡å>
3. å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼šdocker service update --rollback <æœåŠ¡å>
4. æ‰©å®¹å®ä¾‹ï¼šdocker service scale <æœåŠ¡å>=<æ•°é‡>
```

### 10.3 å‡çº§ç»´æŠ¤æµç¨‹

#### Docker Engineå‡çº§
```bash
# 1. é€ä¸ªèŠ‚ç‚¹å‡çº§
docker node update --availability drain <èŠ‚ç‚¹ID>
sudo apt update && sudo apt upgrade docker-ce
docker node update --availability active <èŠ‚ç‚¹ID>

# 2. éªŒè¯å‡çº§
docker version
```

#### 1Panelå‡çº§
```bash
# åœ¨1Panelé¢æ¿ä¸­ç›´æ¥å‡çº§
# æˆ–ä½¿ç”¨å‘½ä»¤
sudo 1panel update
```

---

## ğŸ¯ æ€»ç»“ä¸æœ€ä½³å®è·µ

### æˆåŠŸå…³é”®å› ç´ 
1. **ç½‘ç»œä¼˜å…ˆ**ï¼šç¡®ä¿Tailscaleç½‘ç»œç¨³å®š
2. **æ–‡æ¡£åŒæ­¥**ï¼šä¸¤åœ°ç»´æŠ¤ç›¸åŒçš„é…ç½®æ–‡æ¡£
3. **å®šæœŸæ¼”ç»ƒ**ï¼šæ¯æœˆè¿›è¡Œä¸€æ¬¡æ•…éšœæ¢å¤æ¼”ç»ƒ
4. **ç›‘æ§å‘Šè­¦**ï¼šè®¾ç½®å…³é”®æŒ‡æ ‡çš„å‘Šè­¦

### æ‰©å±•å»ºè®®
1. **å¢åŠ å¤‡ç”¨èŠ‚ç‚¹**ï¼šé˜²æ­¢å•ç‚¹æ•…éšœ
2. **é›†æˆäº‘æœåŠ¡**ï¼šè¿æ¥äº‘å­˜å‚¨ã€äº‘æ•°æ®åº“
3. **è‡ªåŠ¨åŒ–éƒ¨ç½²**ï¼šå®ç°GitOpså·¥ä½œæµ
4. **å®‰å…¨å®¡è®¡**ï¼šå®šæœŸè¿›è¡Œå®‰å…¨æ‰«æ

### è”ç³»ä¸æ”¯æŒ
```
é—®é¢˜åˆ†ç±»ï¼š
1. ç½‘ç»œé—®é¢˜ï¼šæ£€æŸ¥TailscaleçŠ¶æ€
2. Dockeré—®é¢˜ï¼šæ£€æŸ¥Swarmé›†ç¾¤çŠ¶æ€
3. 1Panelé—®é¢˜ï¼šæŸ¥çœ‹é¢æ¿æ—¥å¿—
4. å¼€å‘ç¯å¢ƒé—®é¢˜ï¼šæ£€æŸ¥VS Codeè¿æ¥
```